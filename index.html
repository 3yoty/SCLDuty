<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyShift Pro - Advanced Work Hours Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
        }

        [data-theme="dark"] {
            --primary-color: #6366f1;
            --secondary-color: #34d399;
            --accent-color: #fbbf24;
            --danger-color: #f87171;
            --bg-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --card-bg: rgba(30, 41, 59, 0.95);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .theme-toggle, .lang-toggle {
            padding: 8px 16px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            color: var(--text-primary);
        }

        .theme-toggle:hover, .lang-toggle:hover {
            background: var(--primary-color);
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .card:hover {
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shift-controls {
            grid-column: 1 / -1;
        }

        .shift-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .shift-type {
            padding: 15px;
            background: rgba(var(--primary-color), 0.1);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .shift-type.active {
            border-color: var(--primary-color);
            background: rgba(var(--primary-color), 0.2);
        }

        .shift-type h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .shift-type p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .custom-duration {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }

        .duration-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .duration-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .clock-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .clock-in-btn, .break-btn, .reset-btn {
            flex: 1;
            padding: 18px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .clock-in-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }

        .break-btn {
            background: linear-gradient(135deg, var(--accent-color) 0%, #f59e0b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }

        .reset-btn {
            background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .clock-in-btn:hover, .break-btn:hover, .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .clock-in-btn:disabled, .break-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .session-info {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .session-info.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            padding: 15px;
            background: rgba(var(--secondary-color), 0.1);
            border-radius: 12px;
            border: 1px solid rgba(var(--secondary-color), 0.2);
        }

        .info-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .countdown-container {
            text-align: center;
            margin: 20px 0;
            padding: 25px;
            background: rgba(var(--primary-color), 0.1);
            border-radius: 16px;
            border: 2px solid rgba(var(--primary-color), 0.2);
        }

        .countdown-label {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .countdown-time {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-color);
            font-family: 'Inter', monospace;
        }

        .countdown-time.warning {
            color: var(--accent-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .break-tracking {
            margin-top: 20px;
            padding: 20px;
            background: rgba(var(--accent-color), 0.1);
            border-radius: 12px;
            border: 1px solid rgba(var(--accent-color), 0.2);
        }

        .break-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(var(--accent-color), 0.2);
        }

        .break-item:last-child {
            border-bottom: none;
        }

        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            padding: 20px;
            background: rgba(var(--primary-color), 0.1);
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(var(--primary-color), 0.2);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .calendar-view {
            margin-top: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            padding: 8px 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-nav button:hover {
            background: var(--secondary-color);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(var(--primary-color), 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            position: relative;
        }

        .calendar-day:hover {
            background: rgba(var(--primary-color), 0.2);
        }

        .calendar-day.worked {
            background: var(--secondary-color);
            color: white;
        }

        .calendar-day.today {
            border: 2px solid var(--primary-color);
        }

        .settings-section {
            margin-bottom: 20px;
        }

        .settings-group {
            margin-bottom: 15px;
        }

        .settings-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .settings-input, .settings-select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .settings-input:focus, .settings-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .export-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(var(--secondary-color), 0.1);
            border-radius: 12px;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .export-btn {
            padding: 10px 20px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: var(--primary-color);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideInRight 0.5s ease-out;
            max-width: 300px;
        }

        .notification.success {
            background: var(--secondary-color);
        }

        .notification.warning {
            background: var(--accent-color);
        }

        .notification.error {
            background: var(--danger-color);
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        .notes-section {
            margin-top: 20px;
        }

        .notes-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-primary);
            font-family: inherit;
            resize: vertical;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .productivity-meter {
            margin-top: 20px;
            padding: 20px;
            background: rgba(var(--primary-color), 0.1);
            border-radius: 12px;
        }

        .productivity-bar {
            width: 100%;
            height: 20px;
            background: rgba(var(--primary-color), 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .productivity-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger-color) 0%, var(--accent-color) 50%, var(--secondary-color) 100%);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .clock-actions {
                flex-direction: column;
            }
            
            .statistics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calendar-grid {
                font-size: 0.8rem;
            }
            
            .notification {
                position: fixed;
                top: 10px;
                left: 10px;
                right: 10px;
                margin: 0;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="connectionStatus" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        background: #10b981;
        color: white;
        text-align: center;
        font-weight: bold;
        padding: 8px 0;
        z-index: 2000;
        transition: background 0.3s;
    ">
        ‚úÖ ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ
    </div>
    <div class="app-container">
        <div class="header">
            <div class="logo">MyShift Pro</div>
            <div class="subtitle">Advanced Work Hours Tracker</div>
            <div class="controls">
                <button class="theme-toggle" id="themeToggle">üåô Dark Mode</button>
                <button class="lang-toggle" id="langToggle">üåê ÿπÿ±ÿ®Ÿä</button>
            </div>
        </div>

        <div class="main-content">
            <!-- Shift Controls -->
            <div class="card shift-controls">
                <h3 class="card-title">‚è∞ Shift Controls</h3>
                
                <div class="shift-types">
                    <div class="shift-type" data-hours="8">
                        <h4>Standard Shift</h4>
                        <p>8 hours</p>
                    </div>
                    <div class="shift-type active" data-hours="10">
                        <h4>Extended Shift</h4>
                        <p>10 hours</p>
                    </div>
                    <div class="shift-type" data-hours="12">
                        <h4>Long Shift</h4>
                        <p>12 hours</p>
                    </div>
                    <div class="shift-type" data-hours="4">
                        <h4>Part Time</h4>
                        <p>4 hours</p>
                    </div>
                </div>

                <div class="custom-duration">
                    <label>Custom Duration:</label>
                    <input type="number" class="duration-input" id="customHours" value="10" min="1" max="24" step="0.5">
                    <span>hours</span>
                </div>
                <div class="custom-duration">
                    <label>Manual Clock In:</label>
                    <input type="time" class="duration-input" id="manualClockIn">
                </div>

                <div class="clock-actions">
                    <button class="clock-in-btn" id="clockInBtn">üïê Clock In</button>
                    <button class="reset-btn" id="resetBtn">üîÑ Reset</button>
                </div>

                <div class="session-info" id="sessionInfo">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Clock In</div>
                            <div class="info-value" id="clockInTime">--:--</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Clock Out</div>
                            <div class="info-value" id="clockOutTime">--:--</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Work</div>
                            <div class="info-value" id="totalWork">0h 0m</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Break Time</div>
                            <div class="info-value" id="breakTime">0h 0m</div>
                        </div>
                    </div>

                    <div class="countdown-container">
                        <div class="countdown-label">Time Remaining</div>
                        <div class="countdown-time" id="countdownTime">00:00:00</div>
                    </div>

                    <div class="break-tracking" id="breakTracking">
                        <h4>Break History</h4>
                        <div id="breakList"></div>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="card">
                <h3 class="card-title">üìä Statistics</h3>
                <div class="statistics-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="todayHours">0</div>
                        <div class="stat-label">Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="weekHours">0</div>
                        <div class="stat-label">This Week</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="monthHours">0</div>
                        <div class="stat-label">This Month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="overtimeHours">0</div>
                        <div class="stat-label">Overtime</div>
                    </div>
                </div>

                <div class="productivity-meter">
                    <h4>Productivity Score</h4>
                    <div class="productivity-bar">
                        <div class="productivity-fill" id="productivityFill" style="width: 75%"></div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-weight: 600;" id="productivityScore">75%</div>
                </div>
            </div>

            <!-- Calendar View -->
            <div class="card">
                <h3 class="card-title">üìÖ Calendar</h3>
                <div class="calendar-view">
                    <div class="calendar-header">
                        <h4 id="calendarMonth">December 2024</h4>
                        <div class="calendar-nav">
                            <button id="prevMonth">‚Äπ</button>
                            <button id="nextMonth">‚Ä∫</button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>

            <!-- Settings & Export -->
            <div class="card">
                <h3 class="card-title">‚öôÔ∏è Settings</h3>
                
                <div class="settings-section">
                    <div class="settings-group">
                        <label class="settings-label">Notification Sound</label>
                        <select class="settings-select" id="notificationSound">
                            <option value="beep">Beep</option>
                            <option value="chime">Chime</option>
                            <option value="bell">Bell</option>
                            <option value="none">None</option>
                        </select>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">Warning Time (minutes)</label>
                        <input type="number" class="settings-input" id="warningTime" value="15" min="5" max="60">
                    </div>
                </div>

                <div class="export-section">
                    <h4>Export Data</h4>
                    <div class="export-buttons">
                        <button class="export-btn" id="exportCSV">üìÑ Export CSV</button>
                        <button class="export-btn" id="exportJSON">üìã Export JSON</button>
                        <button class="export-btn" id="backupData">üíæ Backup</button>
                    </div>
                </div>
            </div>

            <!-- Notes -->
            <div class="card">
                <h3 class="card-title">üìù Daily Notes</h3>
                <div class="notes-section">
                    <textarea class="notes-textarea" id="dailyNotes" placeholder="Add notes about your workday..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, set, ref as dbRef, onValue, update, remove, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";


const firebaseConfig = {
            apiKey: "AIzaSyBPYWUqHa6v28jt496_L6ExtXS_pqSQow4",
            authDomain: "shopping-d3ea3.firebaseapp.com",
            databaseURL: "https://shopping-d3ea3-default-rtdb.firebaseio.com",
            projectId: "shopping-d3ea3",
            storageBucket: "shopping-d3ea3.firebasestorage.app",
            messagingSenderId: "434241138137",
            appId: "1:434241138137:web:ce049431ac46db9b93fdc8",
            measurementId: "G-STYC586XED"
        };

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const shiftTodayRef = dbRef(database, "shiftSessions/today");
const shiftHistoryRef = dbRef(database, "shiftSessions/history");


class MyShiftPro {
    constructor() {
        this.isEnglish = true;
        this.isDarkMode = false;
        this.currentSession = null;
        this.breaks = [];
        this.workHistory = [];
        this.settings = {
            notificationSound: 'beep',
            warningTime: 15
        };
        this.countdownInterval = null;
        this.currentDate = new Date();

        this.initializeElements();
        this.bindEvents();
        this.loadData();
        this.updateCalendar();
        this.updateStatistics();
        this.requestNotificationPermission();
    }

    initializeElements() {
        // Main controls
        this.clockInBtn = document.getElementById('clockInBtn');
        this.resetBtn = document.getElementById('resetBtn');
        this.customHours = document.getElementById('customHours');
        this.manualClockIn = document.getElementById('manualClockIn');
        this.sessionInfo = document.getElementById('sessionInfo');

        // Display elements
        this.clockInTime = document.getElementById('clockInTime');
        this.clockOutTime = document.getElementById('clockOutTime');
        this.totalWork = document.getElementById('totalWork');
        this.breakTime = document.getElementById('breakTime');
        this.countdownTime = document.getElementById('countdownTime');
        this.breakList = document.getElementById('breakList');

        // Statistics
        this.todayHours = document.getElementById('todayHours');
        this.weekHours = document.getElementById('weekHours');
        this.monthHours = document.getElementById('monthHours');
        this.overtimeHours = document.getElementById('overtimeHours');
        this.productivityFill = document.getElementById('productivityFill');
        this.productivityScore = document.getElementById('productivityScore');
        
        // Calendar
        this.calendarMonth = document.getElementById('calendarMonth');
        this.calendarGrid = document.getElementById('calendarGrid');
        this.prevMonth = document.getElementById('prevMonth');
        this.nextMonth = document.getElementById('nextMonth');
        
        // Settings
        this.notificationSound = document.getElementById('notificationSound');
        this.warningTime = document.getElementById('warningTime');
        
        // Others
        this.themeToggle = document.getElementById('themeToggle');
        this.langToggle = document.getElementById('langToggle');
        this.dailyNotes = document.getElementById('dailyNotes');
        this.notificationContainer = document.getElementById('notificationContainer');
    }

    bindEvents() {
        // Main controls
        this.clockInBtn.addEventListener('click', () => this.toggleClockIn());
        this.resetBtn.addEventListener('click', () => this.resetSession());
        this.customHours.addEventListener('change', () => this.updateShiftDuration());
        this.manualClockIn.addEventListener('change', () => this.updateManualClockIn());

        // Shift types
        document.querySelectorAll('.shift-type').forEach(type => {
            type.addEventListener('click', () => this.selectShiftType(type));
        });
        
        // Calendar navigation
        this.prevMonth.addEventListener('click', () => this.changeMonth(-1));
        this.nextMonth.addEventListener('click', () => this.changeMonth(1));
        
        // Settings
        this.notificationSound.addEventListener('change', () => this.updateSettings());
        this.warningTime.addEventListener('change', () => this.updateSettings());
        
        // Theme and language
        this.themeToggle.addEventListener('click', () => this.toggleTheme());
        this.langToggle.addEventListener('click', () => this.toggleLanguage());
        
        // Export buttons
        document.getElementById('exportCSV').addEventListener('click', () => this.exportData('csv'));
        document.getElementById('exportJSON').addEventListener('click', () => this.exportData('json'));
        document.getElementById('backupData').addEventListener('click', () => this.backupData());
        
        // Notes
        this.dailyNotes.addEventListener('change', () => this.saveNotes());
        
        // Auto-save every 30 seconds
        setInterval(() => this.saveData(), 30000);
    }

    selectShiftType(selectedType) {
        document.querySelectorAll('.shift-type').forEach(type => {
            type.classList.remove('active');
        });
        selectedType.classList.add('active');
        
        const hours = parseFloat(selectedType.dataset.hours);
        this.customHours.value = hours;
        this.updateShiftDuration();
    }

    updateShiftDuration() {
        if (this.currentSession && this.currentSession.clockInTime) {
            const duration = parseFloat(this.customHours.value);
            this.currentSession.plannedDuration = duration;
            this.currentSession.clockOutTime = new Date(this.currentSession.clockInTime.getTime() + (duration * 60 * 60 * 1000));
            this.updateDisplay();
        }
    }

    updateManualClockIn() {
        // Only update if session not started
        if (!this.currentSession) {
            const today = new Date();
            const [h, m] = this.manualClockIn.value.split(':');
            if (h !== undefined && m !== undefined) {
                today.setHours(parseInt(h), parseInt(m), 0, 0);
                this.manualClockInTime = new Date(today);
            } else {
                this.manualClockInTime = null;
            }
        }
    }

    toggleClockIn() {
        if (!this.currentSession || !this.currentSession.clockInTime) {
            this.clockIn();
        } else {
            this.clockOut();
        }
    }

    clockIn() {
        let now;
        if (this.manualClockInTime) {
            now = new Date(this.manualClockInTime);
        } else {
            now = new Date();
        }
        const duration = parseFloat(this.customHours.value);
        
        this.currentSession = {
            id: Date.now(),
            clockInTime: now,
            clockOutTime: new Date(now.getTime() + (duration * 60 * 60 * 1000)),
            plannedDuration: duration,
            actualClockOutTime: null,
            breaks: [],
            totalBreakTime: 0,
            notes: '',
        };
        
        this.clockInBtn.textContent = 'üïê Clock Out';
        this.sessionInfo.classList.add('active');
        
        this.updateDisplay();
        this.startCountdown();
        this.showNotification(this.isEnglish ? 'Clocked in successfully!' : 'ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠!', 'success');
        this.saveData();
    }

    async sendToGoogleSheet(session) {
        const url = "https://script.google.com/macros/s/AKfycbyyGL8TDjCNUysMuw92_z_IuGFFC6MyTCISAr-8uLoSBcTAa0tVMj8nQt1ZbeBnB2BC/exec";
        const data = {
            date: new Date(session.clockInTime).toLocaleDateString(),
            clockIn: this.formatTime(new Date(session.clockInTime)),
            clockOut: session.actualClockOutTime ? this.formatTime(new Date(session.actualClockOutTime)) : '',
            hours: session.actualDuration ? session.actualDuration.toFixed(2) : '',
            notes: session.notes || ''
        };
        try {
            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });
            if (response.ok) {
                console.log("Data sent");
                this.showNotification(
                    this.isEnglish
                        ? "‚úÖ Data sent to Google Sheets"
                        : "‚úÖ ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ•ŸÑŸâ Google Sheets",
                    "success"
                );
            } else {
                console.log("Failed");
                this.showNotification(
                    this.isEnglish
                        ? "‚ö†Ô∏è Failed to send data"
                        : "‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
                    "warning"
                );
            }
        } catch (e) {
            console.log("Failed");
            this.showNotification(
                this.isEnglish
                    ? "‚ö†Ô∏è Failed to send data"
                    : "‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
                "warning"
            );
        }
    }

    clockOut() {
        this.currentSession.actualClockOutTime = new Date();
        this.currentSession.actualDuration = (this.currentSession.actualClockOutTime - this.currentSession.clockInTime) / (1000 * 60 * 60);
        this.currentSession.notes = this.dailyNotes.value;

        // Add to work history
        this.workHistory.push({...this.currentSession});

        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ•ŸÑŸâ Google Sheet
        this.sendToGoogleSheet(this.currentSession);

        this.showNotification(
            this.isEnglish
                ? `Clocked out! You worked ${this.currentSession.actualDuration.toFixed(1)} hours.`
                : `ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨! ŸÑŸÇÿØ ÿπŸÖŸÑÿ™ ${this.currentSession.actualDuration.toFixed(1)} ÿ≥ÿßÿπÿ©.`,
            'success'
        );

        this.resetSession();
        this.updateStatistics();
        this.updateCalendar();
        this.saveData();
    }

    resetSession() {
        if (this.countdownInterval) {
            clearInterval(this.countdownInterval);
        }
        
        this.currentSession = null;
        this.clockInBtn.textContent = 'üïê Clock In';
        this.sessionInfo.classList.remove('active');
        this.dailyNotes.value = '';
        this.manualClockIn.value = '';
        this.manualClockInTime = null;
        
        this.saveData();
    }

    updateDisplay() {
        if (!this.currentSession) return;
        
        this.clockInTime.textContent = this.formatTime(this.currentSession.clockInTime);
        this.clockOutTime.textContent = this.formatTime(this.currentSession.clockOutTime);
        
        const now = new Date();
        const workedMs = now - this.currentSession.clockInTime;
        const workedHours = Math.floor(workedMs / (1000 * 60 * 60));
        const workedMinutes = Math.floor((workedMs % (1000 * 60 * 60)) / (1000 * 60));
        
        this.totalWork.textContent = `${workedHours}h ${workedMinutes}m`;
        
        // Break always 0
        this.breakTime.textContent = `0h 0m`;
        this.breakList.innerHTML = '';
    }

    startCountdown() {
        if (this.countdownInterval) {
            clearInterval(this.countdownInterval);
        }

        this.countdownInterval = setInterval(() => {
            const now = new Date();
            const remaining = this.currentSession.clockOutTime - now;
            
            if (remaining <= 0) {
                this.countdownTime.textContent = '00:00:00';
                this.countdownTime.classList.remove('warning');
                clearInterval(this.countdownInterval);
                this.showNotification(this.isEnglish ? 'üéâ Your shift is complete!' : 'üéâ ÿßŸÜÿ™Ÿáÿ™ Ÿàÿ±ÿØŸäÿ™ŸÉ!', 'success');
                this.playNotificationSound();
                return;
            }
            
            const hours = Math.floor(remaining / (1000 * 60 * 60));
            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
            
            this.countdownTime.textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Warning notification
            if (remaining <= this.settings.warningTime * 60 * 1000 && !this.countdownTime.classList.contains('warning')) {
                this.countdownTime.classList.add('warning');
                this.showNotification(
                    this.isEnglish
                        ? `‚ö†Ô∏è Only ${this.settings.warningTime} minutes left!`
                        : `‚ö†Ô∏è ÿ™ÿ®ŸÇŸâ ${this.settings.warningTime} ÿØŸÇŸäŸÇÿ© ŸÅŸÇÿ∑!`,
                    'warning'
                );
                this.playNotificationSound();
                this.sendDesktopNotification(
                    this.isEnglish
                        ? `Only ${this.settings.warningTime} minutes left in your shift!`
                        : `ÿ™ÿ®ŸÇŸâ ${this.settings.warningTime} ÿØŸÇŸäŸÇÿ© ŸÅŸÇÿ∑ ŸÅŸä Ÿàÿ±ÿØŸäÿ™ŸÉ!`
                );
            }
            
            this.updateDisplay();
        }, 1000);
    }

    updateStatistics() {
        const today = new Date();
        const todayStr = today.toDateString();
        const weekStart = new Date(today.getFullYear(), today.getMonth(), today.getDate() - today.getDay());
        const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
        
        let todayHours = 0;
        let weekHours = 0;
        let monthHours = 0;
        let overtimeHours = 0;
        
        this.workHistory.forEach(session => {
            if (!session.actualDuration) return;
            
            const sessionDate = new Date(session.clockInTime);
            const workHours = session.actualDuration;
            
            if (sessionDate.toDateString() === todayStr) {
                todayHours += workHours;
            }
            
            if (sessionDate >= weekStart) {
                weekHours += workHours;
            }
            
            if (sessionDate >= monthStart) {
                monthHours += workHours;
            }
            
            if (workHours > 8) {
                overtimeHours += workHours - 8;
            }
        });
        
        this.todayHours.textContent = todayHours.toFixed(1);
        this.weekHours.textContent = weekHours.toFixed(1);
        this.monthHours.textContent = monthHours.toFixed(1);
        this.overtimeHours.textContent = overtimeHours.toFixed(1);
        
        // Calculate productivity score
        const targetHours = 8;
        const productivity = Math.min(100, Math.max(0, (todayHours / targetHours) * 100));
        this.productivityFill.style.width = `${productivity}%`;
        this.productivityScore.textContent = `${Math.round(productivity)}%`;
    }

    updateCalendar() {
        const year = this.currentDate.getFullYear();
        const month = this.currentDate.getMonth();
        
        this.calendarMonth.textContent = new Date(year, month).toLocaleDateString('en-US', {
            month: 'long',
            year: 'numeric'
        });
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay());
        
        this.calendarGrid.innerHTML = '';
        
        // Add day headers
        const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        dayHeaders.forEach(day => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day';
            dayHeader.textContent = day;
            dayHeader.style.fontWeight = 'bold';
            dayHeader.style.background = 'var(--primary-color)';
            dayHeader.style.color = 'white';
            this.calendarGrid.appendChild(dayHeader);
        });
        
        // Add calendar days
        for (let i = 0; i < 42; i++) {
            const currentDate = new Date(startDate);
            currentDate.setDate(startDate.getDate() + i);
            
            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day';
            dayDiv.textContent = currentDate.getDate();
            
            if (currentDate.getMonth() !== month) {
                dayDiv.style.opacity = '0.3';
            }
            
            if (currentDate.toDateString() === new Date().toDateString()) {
                dayDiv.classList.add('today');
            }
            
            // Check if worked on this day
            const workedThisDay = this.workHistory.some(session => 
                new Date(session.clockInTime).toDateString() === currentDate.toDateString()
            );
            
            if (workedThisDay) {
                dayDiv.classList.add('worked');
            }
            
            this.calendarGrid.appendChild(dayDiv);
        }
    }

    changeMonth(direction) {
        this.currentDate.setMonth(this.currentDate.getMonth() + direction);
        this.updateCalendar();
    }

    toggleTheme() {
        this.isDarkMode = !this.isDarkMode;
        document.body.setAttribute('data-theme', this.isDarkMode ? 'dark' : 'light');
        this.themeToggle.textContent = this.isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        this.saveData();
    }

    toggleLanguage() {
        this.isEnglish = !this.isEnglish;
        this.langToggle.textContent = this.isEnglish ? 'üåê ÿπÿ±ÿ®Ÿä' : 'üåê English';
        this.translateInterface();
        this.saveData();
    }

    translateInterface() {
        // Full Arabic translation
        if (!this.isEnglish) {
            document.querySelector('.logo').textContent = 'ŸÖÿßŸä ÿ¥ŸäŸÅÿ™ ÿ®ÿ±Ÿà';
            document.querySelector('.subtitle').textContent = 'ŸÖÿ™ÿ™ÿ®ÿπ ÿ≥ÿßÿπÿßÿ™ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ';
            document.querySelector('.card.shift-controls .card-title').textContent = '‚è∞ ÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿßŸÑŸàÿ±ÿØŸäÿ©';
            document.querySelectorAll('.shift-type')[0].innerHTML = '<h4>Ÿàÿ±ÿØŸäÿ© ÿπÿßÿØŸäÿ©</h4><p>8 ÿ≥ÿßÿπÿßÿ™</p>';
            document.querySelectorAll('.shift-type')[1].innerHTML = '<h4>Ÿàÿ±ÿØŸäÿ© ŸÖŸÖÿ™ÿØÿ©</h4><p>10 ÿ≥ÿßÿπÿßÿ™</p>';
            document.querySelectorAll('.shift-type')[2].innerHTML = '<h4>Ÿàÿ±ÿØŸäÿ© ÿ∑ŸàŸäŸÑÿ©</h4><p>12 ÿ≥ÿßÿπÿ©</p>';
            document.querySelectorAll('.shift-type')[3].innerHTML = '<h4>ÿØŸàÿßŸÖ ÿ¨ÿ≤ÿ¶Ÿä</h4><p>4 ÿ≥ÿßÿπÿßÿ™</p>';
            document.querySelector('.custom-duration label').textContent = 'ÿßŸÑŸÖÿØÿ© ÿßŸÑŸÖÿÆÿµÿµÿ©:';
            document.querySelectorAll('.custom-duration label')[1].textContent = 'ŸàŸÇÿ™ ÿßŸÑÿØÿÆŸàŸÑ ÿßŸÑŸäÿØŸàŸä:';
            this.clockInBtn.textContent = this.currentSession && this.currentSession.clockInTime ? 'üïê ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨' : 'üïê ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ';
            this.resetBtn.textContent = 'üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ';
            document.querySelector('.card:nth-child(2) .card-title').textContent = 'üìä ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™';
            document.querySelectorAll('.stat-label')[0].textContent = 'ÿßŸÑŸäŸàŸÖ';
            document.querySelectorAll('.stat-label')[1].textContent = 'Ÿáÿ∞ÿß ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ';
            document.querySelectorAll('.stat-label')[2].textContent = 'Ÿáÿ∞ÿß ÿßŸÑÿ¥Ÿáÿ±';
            document.querySelectorAll('.stat-label')[3].textContent = 'ÿ≥ÿßÿπÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©';
            document.querySelector('.productivity-meter h4').textContent = 'ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨Ÿäÿ©';
            document.querySelector('.card:nth-child(3) .card-title').textContent = 'üìÖ ÿßŸÑÿ™ŸÇŸàŸäŸÖ';
            document.querySelector('.calendar-header h4').textContent = this.calendarMonth.textContent.replace(/[A-Za-z]+/, m => this.getArabicMonth(m));
            document.querySelector('.card:nth-child(4) .card-title').textContent = '‚öôÔ∏è ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™';
            document.querySelectorAll('.settings-label')[0].textContent = 'ÿµŸàÿ™ ÿßŸÑÿ™ŸÜÿ®ŸäŸá';
            document.querySelectorAll('.settings-label')[1].textContent = 'ŸàŸÇÿ™ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ± (ÿØŸÇÿßÿ¶ŸÇ)';
            document.querySelector('.export-section h4').textContent = 'ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™';
            document.getElementById('exportCSV').textContent = 'üìÑ ÿ™ÿµÿØŸäÿ± CSV';
            document.getElementById('exportJSON').textContent = 'üìã ÿ™ÿµÿØŸäÿ± JSON';
            document.getElementById('backupData').textContent = 'üíæ ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©';
            document.querySelector('.card:last-child .card-title').textContent = 'üìù ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©';
            this.dailyNotes.placeholder = 'ÿ£ÿ∂ŸÅ ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ≠ŸàŸÑ ŸäŸàŸÖ ÿπŸÖŸÑŸÉ...';
            document.documentElement.dir = 'rtl';
        } else {
            // Restore English
            document.querySelector('.logo').textContent = 'MyShift Pro';
            document.querySelector('.subtitle').textContent = 'Advanced Work Hours Tracker';
            document.querySelector('.card.shift-controls .card-title').textContent = '‚è∞ Shift Controls';
            document.querySelectorAll('.shift-type')[0].innerHTML = '<h4>Standard Shift</h4><p>8 hours</p>';
            document.querySelectorAll('.shift-type')[1].innerHTML = '<h4>Extended Shift</h4><p>10 hours</p>';
            document.querySelectorAll('.shift-type')[2].innerHTML = '<h4>Long Shift</h4><p>12 hours</p>';
            document.querySelectorAll('.shift-type')[3].innerHTML = '<h4>Part Time</h4><p>4 hours</p>';
            document.querySelector('.custom-duration label').textContent = 'Custom Duration:';
            document.querySelectorAll('.custom-duration label')[1].textContent = 'Manual Clock In:';
            this.clockInBtn.textContent = this.currentSession && this.currentSession.clockInTime ? 'üïê Clock Out' : 'üïê Clock In';
            this.resetBtn.textContent = 'üîÑ Reset';
            document.querySelector('.card:nth-child(2) .card-title').textContent = 'üìä Statistics';
            document.querySelectorAll('.stat-label')[0].textContent = 'Today';
            document.querySelectorAll('.stat-label')[1].textContent = 'This Week';
            document.querySelectorAll('.stat-label')[2].textContent = 'This Month';
            document.querySelectorAll('.stat-label')[3].textContent = 'Overtime';
            document.querySelector('.productivity-meter h4').textContent = 'Productivity Score';
            document.querySelector('.card:nth-child(3) .card-title').textContent = 'üìÖ Calendar';
            document.querySelector('.calendar-header h4').textContent = this.calendarMonth.textContent;
            document.querySelector('.card:nth-child(4) .card-title').textContent = '‚öôÔ∏è Settings';
            document.querySelectorAll('.settings-label')[0].textContent = 'Notification Sound';
            document.querySelectorAll('.settings-label')[1].textContent = 'Warning Time (minutes)';
            document.querySelector('.export-section h4').textContent = 'Export Data';
            document.getElementById('exportCSV').textContent = 'üìÑ Export CSV';
            document.getElementById('exportJSON').textContent = 'üìã Export JSON';
            document.getElementById('backupData').textContent = 'üíæ Backup';
            document.querySelector('.card:last-child .card-title').textContent = 'üìù Daily Notes';
            this.dailyNotes.placeholder = 'Add notes about your workday...';
            document.documentElement.dir = 'ltr';
        }
    }

    getArabicMonth(engMonth) {
        const months = {
            January: 'ŸäŸÜÿßŸäÿ±', February: 'ŸÅÿ®ÿ±ÿßŸäÿ±', March: 'ŸÖÿßÿ±ÿ≥', April: 'ÿ£ÿ®ÿ±ŸäŸÑ',
            May: 'ŸÖÿßŸäŸà', June: 'ŸäŸàŸÜŸäŸà', July: 'ŸäŸàŸÑŸäŸà', August: 'ÿ£ÿ∫ÿ≥ÿ∑ÿ≥',
            September: 'ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±', October: 'ÿ£ŸÉÿ™Ÿàÿ®ÿ±', November: 'ŸÜŸàŸÅŸÖÿ®ÿ±', December: 'ÿØŸäÿ≥ŸÖÿ®ÿ±'
        };
        return months[engMonth] || engMonth;
    }

    updateSettings() {
        this.settings.notificationSound = this.notificationSound.value;
        this.settings.warningTime = parseInt(this.warningTime.value);
        this.saveData();
    }

    exportData(format) {
        const data = {
            workHistory: this.workHistory,
            settings: this.settings,
            exportDate: new Date().toISOString()
        };
        
        if (format === 'json') {
            const dataStr = JSON.stringify(data, null, 2);
            this.downloadFile(dataStr, 'myshift-data.json', 'application/json');
        } else if (format === 'csv') {
            let csv = this.isEnglish
                ? 'Date,Clock In,Clock Out,Hours Worked,Notes\n'
                : 'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ,ŸàŸÇÿ™ ÿßŸÑÿØÿÆŸàŸÑ,ŸàŸÇÿ™ ÿßŸÑÿÆÿ±Ÿàÿ¨,ÿ≥ÿßÿπÿßÿ™ ÿßŸÑÿπŸÖŸÑ,ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™\n';
            this.workHistory.forEach(session => {
                const date = new Date(session.clockInTime).toLocaleDateString();
                const clockIn = this.formatTime(new Date(session.clockInTime));
                const clockOut = session.actualClockOutTime ? this.formatTime(new Date(session.actualClockOutTime)) : 'N/A';
                const hours = session.actualDuration ? (session.actualDuration).toFixed(2) : '0';
                const notes = session.notes || '';
                
                csv += `${date},"${clockIn}","${clockOut}",${hours},"${notes}"\n`;
            });
            this.downloadFile(csv, 'myshift-data.csv', 'text/csv');
        }
        
        this.showNotification(
            this.isEnglish
                ? `Data exported as ${format.toUpperCase()}`
                : `ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÉŸÄ ${format.toUpperCase()}`,
            'success'
        );
    }

    backupData() {
        const backup = {
            workHistory: this.workHistory,
            settings: this.settings,
            currentSession: this.currentSession,
            isDarkMode: this.isDarkMode,
            isEnglish: this.isEnglish,
            backupDate: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(backup, null, 2);
        this.downloadFile(dataStr, `myshift-backup-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
        this.showNotification('Backup created successfully!', 'success');
    }

    downloadFile(content, filename, contentType) {
        const blob = new Blob([content], { type: contentType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }

    saveNotes() {
        if (this.currentSession) {
            this.currentSession.notes = this.dailyNotes.value;
            this.saveData();
        }
    }

    playNotificationSound() {
        if (this.settings.notificationSound === 'none') return;
        
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch (this.settings.notificationSound) {
                case 'chime':
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    break;
                case 'bell':
                    oscillator.frequency.value = 1200;
                    oscillator.type = 'triangle';
                    break;
                default:
                    oscillator.frequency.value = 600;
                    oscillator.type = 'square';
            }
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        } catch (e) {
            console.log('Audio not supported');
        }
    }

    requestNotificationPermission() {
        if ('Notification' in window) {
            Notification.requestPermission();
        }
    }

    sendDesktopNotification(message) {
        if ('Notification' in window && Notification.permission === 'granted') {
            new Notification('MyShift Pro', {
                body: message,
                icon: '‚è∞',
                badge: '‚è∞'
            });
        }
    }

    showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        this.notificationContainer.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 5000);
    }

    formatTime(date) {
        return date.toLocaleTimeString('en-US', {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        });
    }

    // Storage methods (using in-memory storage for demo)
    saveData() {
        this.savedData = {
            workHistory: this.workHistory,
            settings: this.settings,
            currentSession: this.currentSession,
            isDarkMode: this.isDarkMode,
            isEnglish: this.isEnglish
        };
    }

    loadData() {
        if (this.savedData) {
            this.workHistory = this.savedData.workHistory || [];
            this.settings = {...this.settings, ...this.savedData.settings};
            this.currentSession = this.savedData.currentSession;
            this.isDarkMode = this.savedData.isDarkMode || false;
            this.isEnglish = this.savedData.isEnglish !== undefined ? this.savedData.isEnglish : true;
            
            // Update UI based on loaded data
            document.body.setAttribute('data-theme', this.isDarkMode ? 'dark' : 'light');
            this.themeToggle.textContent = this.isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            this.langToggle.textContent = this.isEnglish ? 'üåê ÿπÿ±ÿ®Ÿä' : 'üåê English';
            
            // Update settings inputs
            this.notificationSound.value = this.settings.notificationSound;
            this.warningTime.value = this.settings.warningTime;
            
            // Restore session if exists
            if (this.currentSession && this.currentSession.clockInTime) {
                this.currentSession.clockInTime = new Date(this.currentSession.clockInTime);
                this.currentSession.clockOutTime = new Date(this.currentSession.clockOutTime);
                
                if (this.currentSession.actualClockOutTime) {
                    this.currentSession.actualClockOutTime = new Date(this.currentSession.actualClockOutTime);
                }
                
                // Restore breaks
                if (this.currentSession.breaks) {
                    this.currentSession.breaks = this.currentSession.breaks.map(breakItem => ({
                        ...breakItem,
                        start: new Date(breakItem.start),
                        end: new Date(breakItem.end)
                    }));
                }
                
                const now = new Date();
                if (now < this.currentSession.clockOutTime) {
                    this.clockInBtn.textContent = 'üïê Clock Out';
                    this.sessionInfo.classList.add('active');
                    this.customHours.value = this.currentSession.plannedDuration;
                    this.dailyNotes.value = this.currentSession.notes || '';
                    
                    this.updateDisplay();
                    this.startCountdown();
                } else {
                    this.currentSession = null;
                }
            }
            
            this.translateInterface();
        }
    }
}

// Initialize the app
document.addEventListener('DOMContentLoaded', () => {
    myShiftPro = new MyShiftPro();
});
    
    // ======================== Firebase Save & Load ========================
    function saveDataToFirebase() {
        const payload = {
            workHistory: myShiftPro.workHistory,
            settings: myShiftPro.settings,
            currentSession: myShiftPro.currentSession,
            isDarkMode: myShiftPro.isDarkMode,
            isEnglish: myShiftPro.isEnglish
        };

        const todayKey = new Date().toISOString().split('T')[0];
        set(shiftTodayRef, payload.currentSession || null);
        set(dbRef(database, `shiftSessions/history/${todayKey}`), payload.currentSession || null);
    }

    function loadDataFromFirebase() {
        onValue(shiftTodayRef, (snapshot) => {
            const session = snapshot.val();
            if (session && session.clockInTime) {
                session.clockInTime = new Date(session.clockInTime);
                session.clockOutTime = new Date(session.clockOutTime);
                if (session.actualClockOutTime)
                    session.actualClockOutTime = new Date(session.actualClockOutTime);
                myShiftPro.currentSession = session;
                myShiftPro.updateDisplay();
                myShiftPro.startCountdown();
            }
        });

        onValue(shiftHistoryRef, (snapshot) => {
            const historyData = snapshot.val();
            if (historyData) {
                myShiftPro.workHistory = Object.values(historyData).filter(Boolean);
                myShiftPro.updateStatistics();
                myShiftPro.updateCalendar();
            }
        });
    }

    // ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑÿ£ÿµŸÑŸäÿ©
    MyShiftPro.prototype.saveData = saveDataToFirebase;
    MyShiftPro.prototype.loadData = loadDataFromFirebase;

import { onValue, ref as dbRef, getDatabase } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

// ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿßÿ™ÿµÿßŸÑ
const connectionStatus = document.getElementById('connectionStatus');
const connectedRef = dbRef(database, ".info/connected");

onValue(connectedRef, (snap) => {
    if (snap.val() === true) {
        connectionStatus.textContent = "‚úÖ ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ";
        connectionStatus.style.background = "#10b981";
    } else {
        connectionStatus.textContent = "‚ùå ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ";
        connectionStatus.style.background = "#ef4444";
    }
});
</script>
</body>
</html>
